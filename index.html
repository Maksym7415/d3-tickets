<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D3 map</title>
</head>
<script src='https://d3js.org/d3.v7.min.js'></script>

<body>
  <h1>Minsk arena</h1>
  <div style="display: flex; justify-content: space-between;" id="d3">
  </div>
  </div>
</body>

<script>
  const w = 600,
    h = 600;

  const svg = d3.select("#d3").append("svg")
    .attr("width", w)
    .attr("height", h)
    .attr("viewBox", "0 0 2000 3000")

  const seatSvg = d3.select("#d3").append("svg")
    .attr("width", w)
    .attr("height", h)
    .attr("viewBox", "0 0 1000 1500")

  async function handleSvg() {
    const data = await d3.json("http://localhost:8000/soho.json");

    let seats = seatSvg.selectAll('.path');
    let sector = svg.selectAll('.path')
      .data(data.entities)
      .enter()
      .append("g")
      .attr("id", (d) => `${d.type}_${d.id}`)
      .on("click", (e) => {
        console.log(e.target.__data__)
        const data = e.target.__data__;

        if (!data.entities) return;
        
        const rowSeats = data.entities
          .find((item) => item.type === 'rowBlock')
          .rows.reduce((acc, val) => ([...acc, ...val.seats]), []);

        const pathsData = data.entities
          .filter((item) => item.type != 'rowBlock');
        
        let seats = seatSvg.selectAll('.path')
          .data(rowSeats)
          .enter()
          .append("g")

        seats
          .append('circle')
          .attr('cx', (d) => d.position.x)
          .attr('cy', (d) => d.position.y)
          .attr('r', '10px')
          .style('fill', "#E7E8E9")

        let paths = seatSvg.selectAll('.path')
          .data(pathsData)
          .enter()
          .append('path')
          .attr("d", (d) => d.points)
          .attr("stroke-width", 0)
          .attr('stroke-linecap', "round")
          .attr('stroke-linkejoin', "round")
          .attr("fill", (d) => d.fill.color)
      })

    sector
      .append('path')
      .attr("d", (d) => d.points)
      .attr("stroke", "#B3B3B3")
      .attr("stroke-width", 0)
      .attr('stroke-linecap', "round")
      .attr('stroke-linkejoin', "round")
      .attr("fill", (d) => d.fill.color)
      
   

    // svg.selectAll(".seat").data(roomArray.seats)
    //   .enter()
    //   .append("g") //<-- each g is a collection of paths that make up the room
    //   .attr("class", "seat")
    //   .selectAll("path")
    //   .data(function (d) {
    //     console.log(d)
    //     return d; //<-- return the array of data for the room
    //   })
    //   .enter()
    //   .append("path")
    //   .attr("d", lineFunction)
    //   .attr("stroke", "blue")
    //   .attr("stroke-width", 2)
    //   .attr("fill", "none")
    //   .on("click", function(d){
    //     console.log(d)
    //     // Determine if current line is visible
    //     console.log('click')
    //     d3.select(".seat path").style("stroke", 'red')
    //     // d3.select("#redAxis").style("opacity", newOpacity);
    //     // Update whether or not the elements are active
    //   })
  }

  handleSvg()


</script>

</html>